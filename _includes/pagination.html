<div class="container">
  <nav class="pagination" role="pagination">
    <ul>
      {% if paginator.previous_page %}
        {% if paginator.previous_page == 1 %}
        <p><a class="newer-posts" href="{{ site.baseurl }}/"><i class="fa fa-long-arrow-left" aria-hidden="true"></i></a></p>
        {% else %}
        <p><a class="newer-posts" href="{{ site.baseurl }}/page/{{ paginator.previous_page }}/"><i class="fa fa-long-arrow-left" aria-hidden="true"></i></a></p>
        {% endif %}
      {% endif %}

      {% if paginator.total_pages > 1 %}
      <p><span class="page-number">Page {{paginator.page}} of {{paginator.total_pages}}</span></p>
      {% endif %}
      
      {% if paginator.next_page %}
      <p><a class="older-posts" href="{{ site.baseurl }}/page/{{ paginator.next_page }}/"><i class="fa fa-long-arrow-right" aria-hidden="true"></i></a></p>
      {% endif %}
    </ul>
  </nav>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      let lang = urlParams.get("lang");

      // Si no hay lang en la URL, usar el idioma del navegador
      if (!lang) {
        const browserLang = navigator.language || navigator.userLanguage;
        lang = browserLang.startsWith("es") ? "es" : "en";
        urlParams.set("lang", lang);
        const newUrl = `${window.location.pathname}?${urlParams.toString()}`;
        window.location.replace(newUrl);
        return; // Para evitar seguir ejecutando en esta carga
      }

      // Aplica el lang a la paginación
      document.querySelectorAll('.pagination a').forEach(link => {
        const url = new URL(link.href);
        url.searchParams.set("lang", lang);
        link.href = url.pathname + url.search;
      });

      // Filtra posts por idioma
      document.querySelectorAll(".post").forEach(post => {
        const postLang = post.dataset.lang;
        post.style.display = (postLang === lang) ? "" : "none";
      });
    
      const langSwitcher = document.getElementById("lang-switcher");
      const url = new URL(window.location.href);
      const currentLang = url.searchParams.get("lang") || "es";
      const newLang = currentLang === "es" ? "en" : "es";

      langSwitcher.textContent = currentLang === "es" ? "🌐 Switch to English" : "🌐 Cambiar a Español";

      langSwitcher.addEventListener("click", (e) => {
        e.preventDefault();
        url.searchParams.set("lang", newLang);
        window.location.href = url.pathname + url.search;
      });
    });
    </script>

    <script>
      const toggle = document.getElementById("themeToggle");
      toggle.addEventListener("click", (e) => {
        e.preventDefault();
        document.body.classList.toggle("dark-mode");
        localStorage.setItem("theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
      });

      // Apply saved theme
      window.addEventListener("DOMContentLoaded", () => {
        if (localStorage.getItem("theme") === "dark") {
          document.body.classList.add("dark-mode");
        }
      });
    </script>
</div>
